<div class="overlays">
  <div class="overlays__header">
    <div class="overlays__header-content">
      <h1 class="overlays__title">{{ labels().title }}</h1>
      <p class="overlays__description">{{ labels().description }}</p>
    </div>
    <div class="overlays__header-actions">
      <div class="overlays__search-group">
        <input type="search" class="overlays__search" [placeholder]="labels().searchPlaceholder" [value]="searchText()"
          (input)="onSearchInput($event)" (keyup.enter)="applySearch()" />
        <button class="overlays__action-btn overlays__action-btn--search" (click)="applySearch()"
          [title]="labels().searchButtonTitle" [attr.aria-label]="labels().searchButtonAria">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
      </div>
    </div>
  </div>

  @if (loading()) {
  <div class="overlays__empty">
    <p>{{ labels().loading }}</p>
  </div>
  } @else if (error()) {
  <div class="overlays__empty">
    <p>{{ labels().error }}</p>
  </div>
  } @else if (rows().length === 0) {
  <div class="overlays__empty">
    <i class="fa-solid fa-layer-group overlays__empty-icon"></i>
    <h2 class="overlays__empty-title">{{ labels().emptyTitle }}</h2>
    <p class="overlays__empty-message">{{ labels().emptyMessage }}</p>
  </div>
  } @else {
  <div class="overlays__table-container">
    <table class="overlays__table">
      <thead>
        <tr>
          <th class="overlays__sortable" (click)="sortBy('name')">
            {{ labels().tableHeaders.name }}
            <i class="fa-solid {{ getSortIcon('name') }}"></i>
          </th>
          <th class="overlays__sortable" (click)="sortBy('owner')">
            {{ labels().tableHeaders.owner }}
            <i class="fa-solid {{ getSortIcon('owner') }}"></i>
          </th>
          <th class="overlays__sortable" (click)="sortBy('template')">
            {{ labels().tableHeaders.template }}
            <i class="fa-solid {{ getSortIcon('template') }}"></i>
          </th>
          <th class="overlays__sortable" (click)="sortBy('updated_at')">
            {{ labels().tableHeaders.updated }}
            <i class="fa-solid {{ getSortIcon('updated_at') }}"></i>
          </th>
          <th class="overlays__table-actions">{{ labels().tableHeaders.actions }}</th>
        </tr>
      </thead>
      <tbody>
        @for (o of sortedRows(); track o.id) {
        <tr>
          <td class="overlays__table-name"><i class="fa-solid fa-layer-group"></i><span>{{ o.name || o.id
              }}</span></td>
          <td [attr.title]="o.owner_username || o.owner_id">{{ o.owner_username || o.owner_id || '—' }}</td>
          <td><span class="overlays__type-badge">{{ o.template || '—' }}</span></td>
          <td>{{ formatDateString(o.updated_at) }}</td>
          <td class="overlays__table-actions">
            <div class="overlays__actions">
              @if (o.owner_id) {
              <a class="overlays__action-btn overlays__action-btn--view" [routerLink]="['/overlay', o.owner_id, o.id]"
                target="_blank" rel="noopener noreferrer" [title]="labels().actions.view"
                [attr.aria-label]="labels().actions.view">
                <i class="fa-solid fa-eye"></i>
              </a>
              } @else {
              <a class="overlays__action-btn overlays__action-btn--view" [routerLink]="['/overlay', o.id]"
                [title]="labels().actions.view" [attr.aria-label]="labels().actions.view">
                <i class="fa-solid fa-eye"></i>
              </a>
              }
              <a class="overlays__action-btn overlays__action-btn--edit" [routerLink]="['/modo/overlays/edit', o.id]"
                [title]="labels().actions.edit" [attr.aria-label]="labels().actions.edit"><i
                  class="fa-solid fa-pen"></i></a>
              <a class="overlays__action-btn overlays__action-btn--delete"
                [routerLink]="['/modo/overlays/delete', o.id]" [title]="labels().actions.delete"
                [attr.aria-label]="labels().actions.delete"><i class="fa-solid fa-trash"></i></a>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  @if (totalPages() > 1) {
  <div class="overlays__pager">
    <button class="overlays__action-btn overlays__action-btn--view" (click)="prev()" [disabled]="page() <= 1"
      [title]="labels().pager.prev" [attr.aria-label]="labels().pager.prev"><i
        class="fa-solid fa-arrow-left"></i></button>
    <span>{{ labels().pager.page }} {{ page() }} / {{ totalPages() }}</span>
    <button class="overlays__action-btn overlays__action-btn--view" (click)="next()" [disabled]="page() >= totalPages()"
      [title]="labels().pager.next" [attr.aria-label]="labels().pager.next"><i
        class="fa-solid fa-arrow-right"></i></button>
  </div>
  }
  }
</div>